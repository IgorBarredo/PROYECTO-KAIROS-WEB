<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Discussion - Proyecto Kairos</title>
  <link rel="stylesheet" href="blog.css">
</head>
<body>
  <!-- Encabezado -->
  <header>
    <div class="logo">P.K. Proyecto Kairos - Open Discussion</div>
    <nav>
      <a href="index.html">Back</a>
      <button class="auth-btn login-btn">Login</button>
      <button class="auth-btn register-btn">Register</button>
    </nav>
  </header>

  <!-- Contenedor principal con sidebars -->
  <div class="main-wrapper">
    
    <!-- Sidebar izquierdo - Navegación tipo árbol -->
    <aside class="sidebar left-sidebar">
      <div class="sidebar-card">
        <h3>Categories</h3>
        <div class="tree-menu">
          
          <!-- Discussions by Year -->
          <div class="tree-item">
            <div class="tree-header" onclick="toggleTree('discussions')">
              <span class="tree-icon">▶</span>
              <span class="tree-title">Discussions Sorted By Year</span>
            </div>
            <div class="tree-content" id="discussions-content">
              
              <!-- 2025 -->
              <div class="tree-subitem" onclick="toggleSubTree('discussions-2025')">
                <span class="tree-icon-small">▶</span>
                <span>2025</span>
              </div>
              <div class="tree-subcontent" id="discussions-2025-content">
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('risk-management-2025', event)">Risk Management in Volatile Markets</a>
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('crypto-trends-2025', event)">Cryptocurrency Trends 2025</a>
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('passive-income-2025', event)">Building Passive Income Streams</a>
              </div>
              
              <!-- 2024 -->
              <div class="tree-subitem" onclick="toggleSubTree('discussions-2024')">
                <span class="tree-icon-small">▶</span>
                <span>2024</span>
              </div>
              <div class="tree-subcontent" id="discussions-2024-content">
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('market-crash-2024', event)">Market Crash Analysis</a>
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('ai-investing-2024', event)">AI in Investment Strategies</a>
                <a href="#" class="tree-link discussion-link" onclick="loadDiscussion('real-estate-2024', event)">Real Estate Market Outlook</a>
              </div>
              
            </div>
          </div>

          <!-- Money -->
          <div class="tree-item">
            <div class="tree-header" onclick="toggleTree('money')">
              <span class="tree-icon">▶</span>
              <span class="tree-title">Money</span>
            </div>
            <div class="tree-content" id="money-content">
              <div class="tree-subitem" onclick="toggleSubTree('money-investing')">
                <span class="tree-icon-small">▶</span>
                <span>Investing</span>
              </div>
              <div class="tree-subcontent" id="money-investing-content">
                <a href="#" class="tree-link">Stock Market Basics</a>
                <a href="#" class="tree-link">Crypto Trading</a>
                <a href="#" class="tree-link">Real Estate</a>
              </div>
              
              <div class="tree-subitem" onclick="toggleSubTree('money-saving')">
                <span class="tree-icon-small">▶</span>
                <span>Saving Strategies</span>
              </div>
              <div class="tree-subcontent" id="money-saving-content">
                <a href="#" class="tree-link">Emergency Funds</a>
                <a href="#" class="tree-link">Retirement Planning</a>
              </div>
              
              <a href="#" class="tree-link">Passive Income</a>
              <a href="#" class="tree-link">Financial Independence</a>
            </div>
          </div>

          <!-- Health -->
          <div class="tree-item">
            <div class="tree-header" onclick="toggleTree('health')">
              <span class="tree-icon">▶</span>
              <span class="tree-title">Health</span>
            </div>
            <div class="tree-content" id="health-content">
              <div class="tree-subitem" onclick="toggleSubTree('health-mental')">
                <span class="tree-icon-small">▶</span>
                <span>Mental Health</span>
              </div>
              <div class="tree-subcontent" id="health-mental-content">
                <a href="#" class="tree-link">Stress Management</a>
                <a href="#" class="tree-link">Mindfulness</a>
              </div>
              
              <a href="#" class="tree-link">Physical Fitness</a>
              <a href="#" class="tree-link">Nutrition</a>
              <a href="#" class="tree-link">Sleep Optimization</a>
            </div>
          </div>

          <!-- Sells -->
          <div class="tree-item">
            <div class="tree-header" onclick="toggleTree('sells')">
              <span class="tree-icon">▶</span>
              <span class="tree-title">Sells</span>
            </div>
            <div class="tree-content" id="sells-content">
              <a href="#" class="tree-link">Sales Techniques</a>
              <a href="#" class="tree-link">Customer Psychology</a>
              <a href="#" class="tree-link">Negotiation Skills</a>
              <a href="#" class="tree-link">Digital Marketing</a>
            </div>
          </div>

          <!-- Business -->
          <div class="tree-item">
            <div class="tree-header" onclick="toggleTree('business')">
              <span class="tree-icon">▶</span>
              <span class="tree-title">Business</span>
            </div>
            <div class="tree-content" id="business-content">
              <div class="tree-subitem" onclick="toggleSubTree('business-startup')">
                <span class="tree-icon-small">▶</span>
                <span>Startup Guide</span>
              </div>
              <div class="tree-subcontent" id="business-startup-content">
                <a href="#" class="tree-link">Business Planning</a>
                <a href="#" class="tree-link">Funding Options</a>
                <a href="#" class="tree-link">Legal Structure</a>
              </div>
              
              <a href="#" class="tree-link">Leadership</a>
              <a href="#" class="tree-link">Team Management</a>
              <a href="#" class="tree-link">Scaling Strategies</a>
            </div>
          </div>

        </div>
      </div>
    </aside>

    <!-- Contenedor central del blog -->
    <div class="blog-container">
      
      <!-- Mensaje principal fijado -->
      <div class="main-post">
        <div class="post-header">
          <h2 id="discussionTitle">Risk Management in Volatile Markets</h2>
          <span class="author">Igor Barredo Arroyo</span>
          <span class="date" id="discussionDate">October 10, 2025</span>
        </div>
        <div class="post-content" id="discussionContent">
          <p>Welcome to our daily discussion space. Here we share insights about markets, strategies, and financial education. Feel free to share your thoughts, ask questions, and engage with the community.</p>
          <p>Today's topic: How do you manage risk in volatile markets?</p>
        </div>
      </div>

      <!-- Formulario para nuevo comentario -->
      <div class="comment-form-container">
        <h3>Share Your Thoughts</h3>
        <form id="commentForm" class="comment-form">
          <input type="text" id="userName" placeholder="Your name" required>
          <textarea id="commentText" placeholder="Write your comment..." required></textarea>
          <button type="submit">Post Comment</button>
        </form>
      </div>

      <!-- Selector de ordenamiento -->
      <div class="sort-controls">
        <span>Sort by:</span>
        <button class="sort-btn active" data-sort="votes">Most Voted</button>
        <button class="sort-btn" data-sort="least-voted">Less Voted</button>
        <button class="sort-btn" data-sort="recent">Most Recent</button>
        <button class="sort-btn" data-sort="ancient">Most Ancient</button>
      </div>

      <!-- Lista de comentarios -->
      <div id="commentsList" class="comments-list">
        <!-- Los comentarios se generarán dinámicamente con JavaScript -->
      </div>

    </div>

    <!-- Sidebar derecho - Paneles informativos -->
    <aside class="sidebar right-sidebar">
      <div class="sidebar-card">
        <h3>Information</h3>
        
        <!-- Panel 1: Community Guidelines -->
        <div class="info-panel">
          <div class="info-header" onclick="toggleInfo('guidelines')">
            <span class="info-title">Community Guidelines</span>
            <span class="info-icon" id="guidelines-icon">▶</span>
          </div>
          <div class="info-content" id="guidelines-content" style="display: none;">
            <p><strong>No censorship:</strong> All viewpoints are welcome in this space.</p>
            <p><strong>Respect above all:</strong> We kindly ask all users to maintain respect towards others, regardless of differing opinions.</p>
            <p><strong>Constructive dialogue:</strong> We highly value constructive criticism, educational insights, and thoughtful contributions.</p>
            <p class="highlight">This is a space for learning and growth. Let's build a respectful community together.</p>
          </div>
        </div>

        <!-- Panel 2: How Voting Works -->
        <div class="info-panel">
          <div class="info-header" onclick="toggleInfo('voting')">
            <span class="info-title">How Voting Works</span>
            <span class="info-icon" id="voting-icon">▶</span>
          </div>
          <div class="info-content" id="voting-content" style="display: none;">
            <p>Use the voting arrows to help prioritize comments:</p>
            <ul>
              <li><strong>Upvote (↑)</strong> - Supports valuable insights and contributions</li>
              <li><strong>Downvote (↓)</strong> - Helps filter less relevant content</li>
            </ul>
            <p>Comments are sorted by votes, allowing the community to highlight the most interesting discussions and perspectives worth reading.</p>
            <p class="tip">Your votes help shape the conversation!</p>
          </div>
        </div>

      </div>
    </aside>

  </div>

  <!-- Footer -->
  <footer>
    <p>© 2025 P.K. Proyecto Kairos. All rights reserved.</p>
  </footer>

  <script>
    // Base de datos de discusiones
    const discussions = {
      'risk-management-2025': {
        title: 'Risk Management in Volatile Markets',
        author: 'Igor Barredo Arroyo',
        date: 'October 10, 2025',
        content: '<p>Welcome to our daily discussion space. Here we share insights about markets, strategies, and financial education. Feel free to share your thoughts, ask questions, and engage with the community.</p><p>Today\'s topic: How do you manage risk in volatile markets?</p>',
        comments: [
          {
            id: 1,
            author: "Maria Garcia",
            text: "Risk management is crucial. I always set stop losses at 2% of my capital per trade. This helps me protect my portfolio from significant losses during volatile periods.",
            votes: 15,
            timestamp: Date.now() - 3600000,
            replies: [{
              id: 101,
              author: "John Doe",
              text: "Great approach! Do you adjust your stop loss based on market volatility?",
              votes: 3,
              timestamp: Date.now() - 3000000
            }]
          }
        ]
      },
      'crypto-trends-2025': {
        title: 'Cryptocurrency Trends 2025',
        author: 'Igor Barredo Arroyo',
        date: 'September 15, 2025',
        content: '<p>The cryptocurrency landscape is evolving rapidly. Let\'s discuss the major trends shaping 2025.</p><p>What are your predictions for Bitcoin, Ethereum, and emerging altcoins?</p>',
        comments: []
      },
      'passive-income-2025': {
        title: 'Building Passive Income Streams',
        author: 'Igor Barredo Arroyo',
        date: 'August 5, 2025',
        content: '<p>Creating passive income is a key strategy for financial independence. Let\'s explore different methods.</p><p>What passive income streams are you currently building or planning to start?</p>',
        comments: []
      },
      'market-crash-2024': {
        title: 'Market Crash Analysis',
        author: 'Igor Barredo Arroyo',
        date: 'December 20, 2024',
        content: '<p>Looking back at the market corrections of 2024, what lessons did we learn?</p><p>How did you protect your portfolio during the downturn?</p>',
        comments: []
      },
      'ai-investing-2024': {
        title: 'AI in Investment Strategies',
        author: 'Igor Barredo Arroyo',
        date: 'November 10, 2024',
        content: '<p>Artificial Intelligence is revolutionizing how we invest. From algorithmic trading to predictive analytics.</p><p>Are you using AI tools in your investment strategy?</p>',
        comments: []
      },
      'real-estate-2024': {
        title: 'Real Estate Market Outlook',
        author: 'Igor Barredo Arroyo',
        date: 'October 1, 2024',
        content: '<p>The real estate market continues to present opportunities despite economic uncertainty.</p><p>What\'s your outlook on real estate investments for the coming years?</p>',
        comments: []
      }
    };

    // Cargar discusión específica
    function loadDiscussion(discussionId, event) {
      event.preventDefault();
      
      const discussion = discussions[discussionId];
      if (discussion) {
        // Actualizar contenido principal
        document.getElementById('discussionTitle').textContent = discussion.title;
        document.getElementById('discussionDate').textContent = discussion.date;
        document.getElementById('discussionContent').innerHTML = discussion.content;
        
        // Cargar comentarios de esta discusión
        comments = discussion.comments || [];
        renderComments();
        
        // Scroll al inicio
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Sistema de navegación tipo árbol
    function toggleTree(category) {
      const content = document.getElementById(`${category}-content`);
      const header = content.previousElementSibling;
      const icon = header.querySelector('.tree-icon');
      
      if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.textContent = '▶';
      } else {
        content.style.display = 'block';
        icon.textContent = '▼';
      }
    }

    function toggleSubTree(subcategory) {
      const content = document.getElementById(`${subcategory}-content`);
      const header = content.previousElementSibling;
      const icon = header.querySelector('.tree-icon-small');
      
      if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.textContent = '▶';
      } else {
        content.style.display = 'block';
        icon.textContent = '▼';
      }
    }

    // Toggle paneles informativos
    function toggleInfo(panelId) {
      const content = document.getElementById(`${panelId}-content`);
      const icon = document.getElementById(`${panelId}-icon`);
      
      if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.textContent = '▼';
      } else {
        content.style.display = 'none';
        icon.textContent = '▶';
      }
    }

    // Sistema de comentarios con votación y respuestas
    let comments = [];
    let currentSort = 'votes';

    // Cargar comentarios de ejemplo (para la discusión inicial)
    function initializeComments() {
      comments = discussions['risk-management-2025'].comments;
      renderComments();
    }

    // Renderizar comentarios
    function renderComments() {
      const commentsList = document.getElementById('commentsList');
      
      // Ordenar comentarios
      let sortedComments = [...comments];
      if (currentSort === 'votes') {
        sortedComments.sort((a, b) => b.votes - a.votes);
      } else if (currentSort === 'least-voted') {
        sortedComments.sort((a, b) => a.votes - b.votes);
      } else if (currentSort === 'recent') {
        sortedComments.sort((a, b) => b.timestamp - a.timestamp);
      } else if (currentSort === 'ancient') {
        sortedComments.sort((a, b) => a.timestamp - b.timestamp);
      }

      // Generar HTML
      commentsList.innerHTML = sortedComments.map(comment => `
        <div class="comment-card" data-id="${comment.id}">
          <div class="vote-section">
            <button class="vote-btn up" onclick="vote(${comment.id}, 1)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5l0 14M5 12l7 -7l7 7"></path>
              </svg>
            </button>
            <span class="vote-count">${comment.votes}</span>
            <button class="vote-btn down" onclick="vote(${comment.id}, -1)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5l0 14M5 12l7 7l7 -7"></path>
              </svg>
            </button>
          </div>
          <div class="comment-content">
            <div class="comment-header">
              <span class="comment-author">${comment.author}</span>
              <span class="comment-time">${getTimeAgo(comment.timestamp)}</span>
            </div>
            <p class="comment-text">${comment.text}</p>
            <div class="comment-actions">
              <button class="action-btn reply-btn" onclick="showReplyForm(${comment.id})">Reply</button>
              ${comment.replies && comment.replies.length > 0 ? `
                <button class="action-btn toggle-replies-btn" onclick="toggleReplies(${comment.id})">
                  View Replies (${comment.replies.length})
                </button>
              ` : ''}
            </div>
            
            <!-- Formulario de respuesta (oculto por defecto) -->
            <div id="replyForm${comment.id}" class="reply-form" style="display: none;">
              <input type="text" id="replyName${comment.id}" placeholder="Your name" required>
              <textarea id="replyText${comment.id}" placeholder="Write your reply..." required></textarea>
              <div class="reply-form-actions">
                <button onclick="submitReply(${comment.id})">Post Reply</button>
                <button onclick="hideReplyForm(${comment.id})">Cancel</button>
              </div>
            </div>

            <!-- Respuestas (ocultas por defecto) -->
            ${comment.replies && comment.replies.length > 0 ? `
            <div id="replies${comment.id}" class="replies-container" style="display: none;">
              ${comment.replies.map(reply => `
                <div class="reply-card">
                  <div class="vote-section-small">
                    <button class="vote-btn-small up" onclick="voteReply(${comment.id}, ${reply.id}, 1)">↑</button>
                    <span class="vote-count-small">${reply.votes}</span>
                    <button class="vote-btn-small down" onclick="voteReply(${comment.id}, ${reply.id}, -1)">↓</button>
                  </div>
                  <div class="reply-content">
                    <div class="reply-header">
                      <span class="reply-author">${reply.author}</span>
                      <span class="reply-time">${getTimeAgo(reply.timestamp)}</span>
                    </div>
                    <p class="reply-text">${reply.text}</p>
                  </div>
                </div>
              `).join('')}
            </div>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    // Sistema de votación para comentarios principales
    function vote(commentId, value) {
      const comment = comments.find(c => c.id === commentId);
      if (comment) {
        comment.votes += value;
        renderComments();
      }
    }

    // Sistema de votación para respuestas
    function voteReply(commentId, replyId, value) {
      const comment = comments.find(c => c.id === commentId);
      if (comment && comment.replies) {
        const reply = comment.replies.find(r => r.id === replyId);
        if (reply) {
          reply.votes += value;
          renderComments();
        }
      }
    }

    // Mostrar/ocultar formulario de respuesta
    function showReplyForm(commentId) {
      const replyForm = document.getElementById(`replyForm${commentId}`);
      replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
    }

    function hideReplyForm(commentId) {
      document.getElementById(`replyForm${commentId}`).style.display = 'none';
    }

    // Enviar respuesta
    function submitReply(commentId) {
      const name = document.getElementById(`replyName${commentId}`).value;
      const text = document.getElementById(`replyText${commentId}`).value;
      
      if (!name || !text) return;
      
      const comment = comments.find(c => c.id === commentId);
      if (comment) {
        if (!comment.replies) comment.replies = [];
        
        const newReply = {
          id: Date.now(),
          author: name,
          text: text,
          votes: 0,
          timestamp: Date.now()
        };
        
        comment.replies.push(newReply);
        hideReplyForm(commentId);
        renderComments();
        
        // Mostrar automáticamente las respuestas después de agregar una
        setTimeout(() => {
          const repliesContainer = document.getElementById(`replies${commentId}`);
          if (repliesContainer) repliesContainer.style.display = 'block';
        }, 100);
      }
    }

    // Toggle respuestas
    function toggleReplies(commentId) {
      const repliesContainer = document.getElementById(`replies${commentId}`);
      if (repliesContainer) {
        repliesContainer.style.display = repliesContainer.style.display === 'none' ? 'block' : 'none';
      }
    }

    // Calcular tiempo transcurrido
    function getTimeAgo(timestamp) {
      const seconds = Math.floor((Date.now() - timestamp) / 1000);
      
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
      return `${Math.floor(seconds / 86400)} days ago`;
    }

    // Manejar nuevo comentario
    document.getElementById('commentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const userName = document.getElementById('userName').value;
      const commentText = document.getElementById('commentText').value;
      
      const newComment = {
        id: Date.now(),
        author: userName,
        text: commentText,
        votes: 0,
        timestamp: Date.now(),
        replies: []
      };
      
      comments.push(newComment);
      renderComments();
      
      // Limpiar formulario
      document.getElementById('userName').value = '';
      document.getElementById('commentText').value = '';
    });

    // Controles de ordenamiento
    document.querySelectorAll('.sort-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentSort = this.getAttribute('data-sort');
        renderComments();
      });
    });

    // Botones de autenticación (placeholder)
    document.querySelector('.login-btn').addEventListener('click', function() {
      alert('Login functionality will be implemented with backend integration.');
    });

    document.querySelector('.register-btn').addEventListener('click', function() {
      alert('Register functionality will be implemented with backend integration.');
    });

    // Inicializar
    initializeComments();
  </script>
</body>
</html>