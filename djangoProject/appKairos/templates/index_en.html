{% extends 'base.html' %}
{% load static %}

{% block title %}Proyecto Kairos - Financial Products{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=Outfit:wght@300;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<header>
  <div class="logo">P.K. Proyecto Kairos</div>
  <nav>
    <a href="{% url 'appKairos:index' %}#graph" class="linked">Results</a>
    <a href="{% url 'appKairos:index' %}#productos" class="linked">Products</a>
    <a href="{% url 'appKairos:how_we_work' %}" class="linked">How we work</a>
    
    <div id="contactDropdown" class="dropdown">
      <span class="dropbtn linked">Contact</span>
      <div class="dropdown-content">
        <a href="{% url 'appKairos:newsletter' %}" class="linked" target="_blank">Newsletter</a>
        <a href="{% url 'appKairos:questions' %}" class="linked">Questions</a>
        <a href="#contacto" class="linked">Contact our team</a>
      </div>
    </div>
    
    {% if user.is_authenticated %}
      <a href="{% url 'appKairos:dashboard' %}" class="auth-btn login-btn">Dashboard</a>
      <a href="{% url 'appKairos:logout' %}" class="auth-btn register-btn">Logout</a>
    {% else %}
      <a href="{% url 'appKairos:login' %}" class="auth-btn login-btn">Login</a>
      <a href="{% url 'appKairos:register' %}" class="auth-btn register-btn">Register</a>
    {% endif %}
  </nav>
</header>

<section id="inicio" class="hero">
  <h1>DO YOU WANT TO GROW YOUR CAPITAL?</h1>
  <h3>FOLLOW THE INSTRUCTIONS AND CONNECT TO OUR PRODUCTS</h3>
  <a href="{% url 'appKairos:connect_mt5' %}" class="btn">START NOW</a>
</section>

<section id="graph" class="grafica">
  <h2>SELECT DIFFERENT PRODUCTS AND COMPARE THEM WITH EACH OTHER AND WITH THE MARKETS</h2>
  
  <div class="tabs-container">
    <button class="tab-btn active" data-product="mpt">M.P.T. MarketProThief</button>
    <button class="tab-btn active" data-product="golden">GoldenRoad</button>
    <button class="tab-btn active" data-product="multi">MultiMarkets</button>
  </div>
  
  <canvas id="capitalChart"></canvas>
</section>

<section id="productos" class="productos">
  <h2>FINANCIAL PRODUCTS</h2>
  <div class="productos-container">
    <div class="producto-card">
      <h3>M.P.T. MarketProThief</h3>
      <div class="cont">
        <p>XAAUSD</p>
        <p>NasdaQ</p>
        <p>SP500</p>
      </div>
      <a href="#graph">Check Graph Details</a>
    </div>
    
    <div class="producto-card">
      <h3>GoldenRoad</h3>
      <div class="cont">
        <p>XAAUSD</p> 
      </div>
      <a href="#graph">Check Graph Details</a>
    </div>
    
    <div class="producto-card">
      <h3>MultiMarkets</h3>
      <div class="cont">
        <p>NasdaQ</p>
        <p>SP500</p>
      </div>
      <a href="#graph">Check Graph Details</a>
    </div>
  </div>
</section>

<section id="contacto" class="contacto">
  <h2>CONTACT OUR TEAM</h2>
  <form method="POST" action="{% url 'appKairos:contacto' %}">
    {% csrf_token %}
    <input type="text" name="nombre" placeholder="Name" required>
    <input type="email" name="email" placeholder="Email" required>
    <textarea name="mensaje" placeholder="Write your message here ..." required></textarea>
    <button type="submit">Send</button>
  </form>

  <div class="redes">
    <a href="https://instagram.com" target="_blank">
      <img src="{% static '/img/ig.jpg' %}" alt="Instagram">
    </a>
    <a href="https://youtube.com" target="_blank">
      <img src="{% static '/img/youtube.png' %}" alt="YouTube">
    </a>
    <a href="https://linkedin.com" target="_blank">
      <img src="{% static '/img/linkedin.png' %}" alt="LinkedIn">
    </a>
  </div>
</section>

<footer>
  <p>© 2025 P.K. Proyecto Kairos. All rights reserved.</p>
</footer>
{% endblock %}

{% block extra_js %}
<script>
  // --- Gráfica Chart.js ---
  const ctx = document.getElementById('capitalChart');
  
  const productData = {
    mpt: {
      label: 'M.P.T MarketProThief (€)',
      data: [1000, 2300, 3800, 5200, 6800, 8500],
      borderColor: '#00b4d8',
      backgroundColor: 'rgba(0,180,216,0.2)'
    },
    golden: {
      label: 'GoldenRoad (€)',
      data: [800, 1600, 2800, 4100, 5600, 7200],
      borderColor: '#FFD700',
      backgroundColor: 'rgba(255,215,0,0.2)'
    },
    multi: {
      label: 'MultiMarkets (€)',
      data: [1200, 2100, 3200, 4500, 6000, 7800],
      borderColor: '#00ff88',
      backgroundColor: 'rgba(0,255,136,0.2)'
    }
  };

  let capitalChart;
  let activeProducts = ['mpt', 'golden', 'multi'];

  function updateChart() {
    const datasets = activeProducts.map(product => ({
      label: productData[product].label,
      data: productData[product].data,
      borderColor: productData[product].borderColor,
      backgroundColor: productData[product].backgroundColor,
      fill: true,
      tension: 0.3,
      pointBackgroundColor: productData[product].borderColor,
      pointBorderColor: '#fff',
      pointRadius: 5
    }));

    if (capitalChart) {
      capitalChart.data.datasets = datasets;
      capitalChart.update();
    } else {
      capitalChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
          datasets: datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#fff'
              }
            }
          },
          scales: {
            x: {
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255,255,255,0.1)' }
            },
            y: {
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255,255,255,0.1)' }
            }
          }
        }
      });
    }
  }

  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const product = this.getAttribute('data-product');
      
      if (this.classList.contains('active')) {
        this.classList.remove('active');
        activeProducts = activeProducts.filter(p => p !== product);
      } else {
        this.classList.add('active');
        activeProducts.push(product);
      }
      
      if (activeProducts.length > 0) {
        updateChart();
      }
    });
  });

  if (ctx) {
    updateChart();
  }

  // --- Lógica "Pegajosa" DEFINITIVA para el Menú (3 SEGUNDOS) ---
  document.addEventListener('DOMContentLoaded', () => {
      const dropdown = document.getElementById('contactDropdown');
      
      if (dropdown) {
          const dropdownContent = dropdown.querySelector('.dropdown-content');
          let closeTimer = null;

          // Función para abrir: Borra cualquier temporizador de cierre pendiente
          const openMenu = () => {
              if (closeTimer) {
                  clearTimeout(closeTimer);
                  closeTimer = null;
              }
              dropdownContent.classList.add('show');
          };

          // Función para cerrar: Inicia la cuenta atrás de 3 segundos
          const startCloseTimer = () => {
              if (!closeTimer) {
                  closeTimer = setTimeout(() => {
                      dropdownContent.classList.remove('show');
                      closeTimer = null;
                  }, 250); // 3000ms = 3 segundos
              }
          };

          // Eventos solo en el CONTENEDOR PADRE
          // Al entrar en el padre (botón O menú), se abre/mantiene.
          // Al salir del padre (al vacío), empieza la cuenta atrás.
          dropdown.addEventListener('mouseenter', openMenu);
          dropdown.addEventListener('mouseleave', startCloseTimer);

          // Cerrar inmediatamente al hacer clic en un enlace
          dropdownContent.querySelectorAll('a').forEach(link => {
              link.addEventListener('click', () => {
                  dropdownContent.classList.remove('show');
              });
          });
      }
  });
</script>
{% endblock %}